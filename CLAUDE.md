# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

OpenJade is an implementation of the ISO/IEC 10179:1996 DSSSL (Document Style Semantics and Specification Language) standard. It processes SGML/XML documents using DSSSL stylesheets and transforms them into various output formats:
- RTF (Rich Text Format)
- TeX
- MIF (FrameMaker)
- SGML/XML transformations
- HTML+CSS
- FOT (Flow Object Tree as XML)

OpenJade is built on top of OpenSP (SGML parser library) and is written in C++.

## Build Commands

```bash
# Configure (requires OpenSP installed, e.g. via homebrew: open-sp)
./configure --enable-spincludedir=/opt/homebrew/opt/open-sp/include/OpenSP \
            --enable-splibdir=/opt/homebrew/opt/open-sp/lib \
            --prefix=/path/to/install

# Build
make

# Install
make install

# Clean
make clean
```

## Running OpenJade

```bash
# Basic usage (outputs FOT by default)
./jade/openjade -c dsssl/catalog document.sgml

# Specify output type and stylesheet
./jade/openjade -c dsssl/catalog -t rtf -d stylesheet.dsl document.sgml

# Output types: fot, rtf, tex, sgml, xml, html, mif
```

## Running Tests

```bash
cd testsuite
make all
```

## Architecture

### Library Structure

- **grove/** - SGML grove library implementing the SGML property set. Provides the `Node` class hierarchy for representing parsed SGML documents as a node tree.

- **spgrove/** - Bridges OpenSP parser events to grove nodes. `GroveBuilder` constructs the grove from parser events; `SdNode` handles SGML declaration nodes.

- **style/** - Core DSSSL engine:
  - `Interpreter` - DSSSL Scheme interpreter with garbage collection (`Collector`)
  - `FOTBuilder` - Abstract base class for flow object tree construction
  - `DssslApp` - Application framework for DSSSL processing
  - `Expression`, `Insn` - Expression parsing and VM instruction compilation
  - `ProcessingMode`, `Pattern` - DSSSL processing mode and pattern matching
  - `ELObj` - Expression language objects (Scheme values)

- **jade/** - Output backends:
  - `RtfFOTBuilder` - RTF output
  - `TeXFOTBuilder` - TeX output (for use with JadeTeX)
  - `HtmlFOTBuilder` - HTML+CSS output
  - `MifFOTBuilder` - FrameMaker MIF output
  - `SgmlFOTBuilder` - SGML/XML transformation output
  - `TransformFOTBuilder` - SGML transformation backend
  - `jade.cxx` - Main entry point (`JadeApp`)

### Key Dependencies

- **OpenSP** - Required external dependency for SGML parsing. Include path and library path configured via `--enable-spincludedir` and `--enable-splibdir`.

### Build System

Uses autoconf/automake with custom Makefile structure:
- `Makefile.comm` - Common definitions
- `Makefile.lib` - Library build rules
- `Makefile.prog` - Program build rules
- `*/Makefile.sub` - Per-directory source lists
- `*/Makefile.dep` - Dependencies
- `*/Makefile.lt` - Libtool rules (generated)

### Message Generation

Error and warning messages are defined in `*Messages.h` files and generated by `msggen.pl`.

## Commit Policy

Use single-line commit messages only. No extended descriptions, no co-author tags, no generation notices.
